(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-shape"),require("d3-selection"),require("d3-scale"),require("d3-path"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-shape","d3-selection","d3-scale","d3-path","d3-array"],t):(e=e||self,t(e.fc=e.fc||{},e.d3,e.d3,e.d3,e.d3,e.d3))})(this,function(e,t,a,n,i,r){'use strict';var f=Math.abs;function l(){var e=arguments;return function(t,a){for(var n=0,i=e.length;n<i;n++)if(null==e[n](t,a))return!1;return!0}}function d(e){switch(e){case ce.BYTE:case ce.UNSIGNED_BYTE:return 1;case ce.SHORT:case ce.UNSIGNED_SHORT:return 2;case ce.FLOAT:return 4;default:throw new Error(`Unknown type ${e}`);}}function o(e){switch(e){case ce.BYTE:return Int8Array;case ce.UNSIGNED_BYTE:return Uint8Array;case ce.SHORT:return Int16Array;case ce.UNSIGNED_SHORT:return Uint16Array;case ce.FLOAT:return Float32Array;default:throw new Error(`Unknown type ${e}`);}}function s(e){return u(e)||c(e)||h()}function u(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var g="default"in t?t["default"]:t,b="default"in n?n["default"]:n;const p=1e-6;var y=(e,t)=>{e=e||"g";let a=(e,t)=>t,n=null;const i=function(i,r){r=r||(e=>e);const l=i.selection?i:null;l&&(i=i.selection());const d=i.selectAll((e,t,a)=>Array.from(a[t].childNodes).filter(e=>1===e.nodeType)).filter(null==t?e:`${e}.${t}`);let o=d.data(r,a);const s=o.enter().append(e).attr("class",t);let u=o.exit();o=o.merge(s);const c=l||n;return c&&(o=o.transition(c).style("opacity",1),s.style("opacity",p),u=u.transition(c).style("opacity",p)),u.remove(),o.enter=()=>s,o.exit=()=>u,o};return i.element=(...t)=>t.length?(e=t[0],i):e,i.className=(...e)=>e.length?(t=e[0],i):t,i.key=(...e)=>e.length?(a=e[0],i):a,i.transition=(...e)=>e.length?(n=e[0],i):n,i},S=(e,t,a)=>{const n=t[a];if("function"!=typeof n)throw new Error(`Attempt to rebind ${a} which isn't a function on the source object`);return(...a)=>{var i=n.apply(t,a);return i===t?e:i}},v=(e,t,...a)=>{for(const n of a)e[n]=S(e,t,n);return e};const m=e=>t=>e.reduce((e,t)=>e&&t(e),t);var x=(e,t,...a)=>{const n=m(a);for(const i of Object.keys(t)){const a=n(i);a&&(e[a]=S(e,t,i))}return e},A=e=>e.map(e=>"string"==typeof e?new RegExp(`^${e}$`):e),V=(...e)=>(e=A(e),t=>e.every(e=>!e.test(t))&&t),w=e=>t=>e[t],T=function(e){return"function"==typeof e?e:function(){return e}},E=function(e,t){return"left"===e?t/2:"right"===e?-t/2:0},N=function(e){var t=Object.assign({},e),a=function(){};return Object.keys(t).forEach(function(e){a[e]=function(){return arguments.length?(t[e]=0>=arguments.length?void 0:arguments[0],a):t[e]}}),a},I=function(){var e=function(){return 0},t=function(e){return e.x},a=function(e){return e.y},r="center",o=function(){return 5},s="vertical",u=N({decorate:function(){},defined:function(n,r){return l(e,t,a)(n,r)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return u.values=function(n,l){var i=o(n,l),d=E(r,i),c=u.xScale(),h=u.yScale();if("vertical"===s){var f=h(a(n,l),l),g=h(e(n,l),l),b=c(t(n,l),l)+d;return{d:n,x:b,y:f,y0:g,width:i,height:f-g,origin:[b,f],baseOrigin:[b,g],transposedX:b,transposedY:f}}var p=c(a(n,l),l),y=c(e(n,l),l),S=h(t(n,l),l)+d;return{d:n,x:S,y:p,y0:y,width:i,height:p-y,origin:[p,S],baseOrigin:[y,S],transposedX:p,transposedY:S}},u.xValues=function(){return"vertical"===s?[t]:[e,a]},u.yValues=function(){return"vertical"===s?[e,a]:[t]},u.baseValue=function(){return arguments.length?(e=T(0>=arguments.length?void 0:arguments[0]),u):e},u.crossValue=function(){return arguments.length?(t=T(0>=arguments.length?void 0:arguments[0]),u):t},u.mainValue=function(){return arguments.length?(a=T(0>=arguments.length?void 0:arguments[0]),u):a},u.bandwidth=function(){return arguments.length?(o=T(0>=arguments.length?void 0:arguments[0]),u):o},u.align=function(){return arguments.length?(r=0>=arguments.length?void 0:arguments[0],u):r},u.orient=function(){return arguments.length?(s=0>=arguments.length?void 0:arguments[0],u):s},u},B={red:"#c60",green:"#6c0",black:"#000",gray:"#ddd",darkGray:"#999"},P=function(){var e=I(),n=t.line().x(function(t,a){return e.values(t,a).transposedX}).y(function(t,a){return e.values(t,a).transposedY}),i=y("path","line"),r=function(t){t.selection&&i.transition(t),n.defined(e.defined()),t.each(function(t,r,l){var d=i(a.select(l[r]),[t]);d.enter().attr("fill","none").attr("stroke",B.black),d.attr("d",n),e.decorate()(d,t,r)})};return x(r,e,V("baseValue","bandwidth","align")),v(r,i,"key"),v(r,n,"curve"),r},R=function(){var e=I(),a=t.line().x(function(t,a){return e.values(t,a).transposedX}).y(function(t,a){return e.values(t,a).transposedY}),n=function(t){var n=a.context();n.beginPath(),n.strokeStyle=B.black,n.fillStyle="transparent",e.decorate()(n,t),a.defined(e.defined())(t),n.fill(),n.stroke(),n.closePath()};return x(n,e,V("baseValue","bandwidth","align")),v(n,a,"curve","context"),n},_=function(e){return e.copy.toString()===b.scaleIdentity().copy.toString()},k=()=>{let e=[0,1],t=[-1,1];const a=()=>{};return a.domain=(...t)=>t.length?(e=t[0],a):e,a.range=(...e)=>e.length?(t=e[0],a):t,a},H=()=>{const e={},t={};let a=null;const n=(n,i)=>{const r=n.context();Object.keys(e).forEach(t=>{const a=e[t];if("function"!=typeof a)throw new Error(`Expected an attribute for ${t}, found ${a}`);const l=r.getAttribLocation(i,t);a.location(l)(n)}),Object.keys(t).forEach(e=>{const a=t[e];if("function"!=typeof a)throw new Error(`Expected a uniform for ${e}, found ${a}`);const l=r.getUniformLocation(i,e);a.location(l)(n)}),null!==a&&a(n)};return n.attribute=(...t)=>1===t.length?e[t[0]]:(e[t[0]]=t[1],n),n.uniform=(...e)=>1===e.length?t[e[0]]:(t[e[0]]=e[1],n),n.elementIndices=(...e)=>e.length?(a=e[0],n):a,n},D=e=>{let t=-1,a=e,n=!0;const i=e=>{if(n){const i=e.context();if(Array.isArray(a))switch(a.length){case 1:i.uniform1fv(t,a);break;case 2:i.uniform2fv(t,a);break;case 3:i.uniform3fv(t,a);break;case 4:i.uniform4fv(t,a);break;default:throw new Error(`Uniform supports up to 4 elements. ${a.length} provided.`);}else i.uniform1f(t,a);n=!1}};return i.location=(...e)=>e.length?(t!==e[0]&&(t=e[0],n=!0),i):t,i.data=(...e)=>e.length?(a=e[0],n=!0,i):a,i},G={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},L=()=>{function e(e,t,a){if(!e)return!0;const i=n.getAttachedShaders(e),r=n.getShaderSource(i[0]),l=n.getShaderSource(i[1]);return t!==r||a!==l}function t(e,t){const i=a(e,n.VERTEX_SHADER),r=a(t,n.FRAGMENT_SHADER),l=n.createProgram();if(n.attachShader(l,i),n.attachShader(l,r),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS)){const a=n.getProgramInfoLog(l);throw n.deleteProgram(l),new Error(`Failed to link program : ${a}
            Vertex Shader : ${e}
            Fragment Shader : ${t}`)}return l}function a(e,t){const a=n.createShader(t);if(n.shaderSource(a,e),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS)){const t=n.getShaderInfoLog(a);throw n.deleteShader(a),new Error(`Failed to compile shader : ${t}
            Shader : ${e}`)}return a}let n=null,i=null,r=null,l=null,d=G.TRIANGLES,o=H();const s=a=>{const u=r(),c=l();e(i,u,c)&&(n.isProgram(i)&&n.deleteProgram(i),i=t(u,c)),n.useProgram(i),o.uniform("uScreen",D([n.canvas.width,n.canvas.height])),o(s,i);var h=n.getExtension("ANGLE_instanced_arrays");if(d!==G.POINTS&&d!==G.TRIANGLES)throw Error(`Expected mode TRIANGLES (${G.TRIANGLES}) or POINTS (${G.POINTS}). ${d} received instead.`);if(null==o.elementIndices())throw Error("Element indices must be provided.");h.drawElementsInstancedANGLE(d,o.elementIndices().data().length,n.UNSIGNED_SHORT,0,a)};return s.context=(...e)=>e.length?(n=e[0],s):n,s.buffers=(...e)=>e.length?(o=e[0],s):o,s.vertexShader=(...e)=>e.length?(r=e[0],s):r,s.fragmentShader=(...e)=>e.length?(l=e[0],s):l,s.mode=(...e)=>e.length?(d=e[0],s):d,s},C=e=>{function t(e,t){e.push(t)}function a(e,t,a){const n=e.indexOf(a);e.splice(0<=n?n:e.length,0,t)}function n(e,t){const a=e.indexOf(t);-1===a&&e.push(t)}const i=[],r=[],l=()=>e(i.join("\n"),r.join("\n"));return l.appendHeader=e=>(t(i,e),l),l.insertHeader=(e,t)=>(a(i,e,t),l),l.appendHeaderIfNotExists=e=>(n(i,e),l),l.appendBody=e=>(t(r,e),l),l.insertBody=(e,t)=>(a(r,e,t),l),l.appendBodyIfNotExists=e=>(n(r,e),l),l};const z=(e,t)=>`
precision mediump float;
float inf = 1.0 / 0.0;
${e}
void main() {
    ${t}
}`,Y=(e,t)=>`
precision mediump float;
${e}
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    ${t}
}`,U={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 2.0 * sqrt(aSize / 3.14159);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},O={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = sqrt(aSize);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},F={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = sqrt((16.0 * aSize) / (3.0 * sqrt(3.0)));
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},Q={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vStrokeWidthRatio;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 3.0 * sqrt(aSize / 5.0);
        vStrokeWidthRatio = uStrokeWidth / (vSize + uStrokeWidth + 1.0);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},W={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aOpenValue;
        attribute float aCloseValue;
        attribute float aLowValue;
        attribute vec3 aCorner;
        attribute float aDefined;
    
        uniform vec2 uScreen;
        uniform float uStrokeWidth;
        
        varying float vColorIndicator;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vColorIndicator = sign(aCloseValue - aOpenValue);

        float isPositiveY = (sign(aCorner.y) + 1.0) / 2.0;
        float isNotPositiveY = 1.0 - isPositiveY;
        float isExtremeY = abs(aCorner.y) - 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;
        float yValue =
         (isPositiveY * isExtremeY * aLowValue) + 
         (isPositiveY * isNotExtremeY * aCloseValue) +
         (isNotPositiveY * isNotExtremeY * aOpenValue) +
         (isNotPositiveY * isExtremeY * aHighValue);

        float lineWidthXDirection = (isNotExtremeY * aCorner.x) + (isExtremeY * aCorner.z);
        float lineWidthYDirection = isNotExtremeY * sign(aCloseValue - aOpenValue) * aCorner.y;

        float bandwidthModifier = aBandwidth * aCorner.x / 2.0;

        float xModifier = (uStrokeWidth * lineWidthXDirection / 2.0) + bandwidthModifier;
        float yModifier = uStrokeWidth * lineWidthYDirection / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},M={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aOpenValue;
        attribute float aCloseValue;
        attribute float aLowValue;
        attribute vec3 aCorner;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vColorIndicator;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vColorIndicator = sign(aCloseValue - aOpenValue);

        float isPositiveY = (sign(aCorner.y) + 1.0) / 2.0;
        float isNotPositiveY = 1.0 - isPositiveY;
        float isExtremeY = abs(aCorner.y) - 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;
        float yValue = 
            (isPositiveY * isExtremeY * aLowValue) + 
            (isPositiveY * isNotExtremeY * aCloseValue) +
            (isNotPositiveY * isNotExtremeY * aOpenValue) +
            (isNotPositiveY * isExtremeY * aHighValue);

        float lineWidthXDirection = isExtremeY * aCorner.z;
        float lineWidthYDirection = isNotExtremeY * aCorner.z;

        float bandwidthModifier = isNotExtremeY * aCorner.x * aBandwidth / 2.0;

        float xModifier = (uStrokeWidth * lineWidthXDirection / 2.0) + bandwidthModifier;
        float yModifier = uStrokeWidth * lineWidthYDirection / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},q={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aMainValue;
        attribute float aBaseValue;
        attribute vec2 aCorner;
        attribute float aDefined;
        
        uniform vec2 uScreen;
        uniform float uStrokeWidth;
        
        varying float vDefined;`,body:`
        vDefined = aDefined;
        float isBaseline = (1.0 - aCorner.y) / 2.0;
        float yValue = (isBaseline * aBaseValue) + ((1.0 - isBaseline) * aMainValue);

        float xModifier = aCorner.x * (aBandwidth) / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},X={header:`
        attribute vec3 aCorner;
        attribute float aCrossNextValue;
        attribute float aMainNextValue;
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aCrossPrevValue;
        attribute float aMainPrevValue;
        attribute float aCrossPrevPrevValue;
        attribute float aMainPrevPrevValue;
        attribute float aDefined;
        attribute float aDefinedNext;
        
        uniform float uStrokeWidth;
        uniform vec2 uScreen;

        varying float vDefined;`,body:`
        vDefined = aDefined * aDefinedNext;
        vec4 next = vec4(aCrossNextValue, aMainNextValue, 0, 0);
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);
        vec4 prev = vec4(aCrossPrevValue, aMainPrevValue, 0, 0);
        vec4 prevPrev = vec4(aCrossPrevPrevValue, aMainPrevPrevValue, 0, 0);`},j={body:`
        vec4 prevVertexPosition = gl_Position;
        vec4 currVertexPosition = gl_Position;
        
        if (all(equal(prev.xy, prevPrev.xy))) {
            prevPrev.xy = prev.xy + normalize(prev.xy - prevVertexPosition.xy);
        }
        if (all(equal(prev.xy, prevVertexPosition.xy))) {
            prevVertexPosition.xy = prev.xy + normalize(prev.xy - prevPrev.xy);
        }
        vec2 A = normalize(normalize(prev.xy - prevPrev.xy) * uScreen);
        vec2 B = normalize(normalize(prevVertexPosition.xy - prev.xy) * uScreen);
        vec2 tangent = normalize(A + B);
        vec2 miter = vec2(-tangent.y, tangent.x);
        vec2 normalA = vec2(-A.y, A.x);
        float miterLength = 1.0 / dot(miter, normalA);
        vec2 point = normalize(A - B);
        if (miterLength > 10.0 && sign(aCorner.x * dot(miter, point)) > 0.0) {
            prevVertexPosition.xy = prev.xy - (aCorner.x * aCorner.y * uStrokeWidth * normalA) / uScreen.xy;
        } else {
            prevVertexPosition.xy = prev.xy + (aCorner.x * miter * uStrokeWidth * miterLength) / uScreen.xy;
        }

        if (all(equal(currVertexPosition.xy, prev.xy))) {
            prev.xy = currVertexPosition.xy + normalize(currVertexPosition.xy - next.xy);
        }
        if (all(equal(currVertexPosition.xy, next.xy))) {
            next.xy = currVertexPosition.xy + normalize(currVertexPosition.xy - prev.xy);
        }
        vec2 C = normalize(normalize(currVertexPosition.xy - prev.xy) * uScreen);
        vec2 D = normalize(normalize(next.xy - currVertexPosition.xy) * uScreen);
        vec2 tangentCD = normalize(C + D);
        vec2 miterCD = vec2(-tangentCD.y, tangentCD.x);
        vec2 normalC = vec2(-C.y, C.x);
        float miterCDLength = 1.0 / dot(miterCD, normalC);
        vec2 pointCD = normalize(C - D);
        if (miterCDLength > 10.0 && sign(aCorner.x * dot(miterCD, pointCD)) > 0.0) {
            currVertexPosition.xy = currVertexPosition.xy - (aCorner.x * aCorner.y * uStrokeWidth * normalC) / uScreen.xy;
        } else {
            currVertexPosition.xy = currVertexPosition.xy + (aCorner.x * miterCD * uStrokeWidth * miterCDLength) / uScreen.xy;
        }
        
        gl_Position.xy = ((1.0 - aCorner.z) * prevVertexPosition.xy) + (aCorner.z * currVertexPosition.xy);`},K={header:`
        attribute vec3 aCorner;
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aLowValue;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;
        
        varying float vDefined;`,body:`
        vDefined = aDefined;
        float isLow = (aCorner.y + 1.0) / 2.0;
        float yValue = isLow * aLowValue + (1.0 - isLow) * aHighValue;

        float isEdgeCorner = abs(aCorner.x);
        float lineWidthXDirection = (1.0 - isEdgeCorner) * aCorner.z;
        float lineWidthYDirection = isEdgeCorner * aCorner.z;
        
        gl_Position = vec4(aCrossValue, yValue, 0, 1);
        
        float xModifier = (uStrokeWidth * lineWidthXDirection) + (aBandwidth * aCorner.x / 2.0);
        float yModifier = (uStrokeWidth * lineWidthYDirection);`},J={header:`
        attribute vec3 aCorner;
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aCrossPrevValue;
        attribute float aMainPrevValue;
        attribute float aBaseValue;
        attribute float aBasePrevValue;
        attribute float aDefined;
        attribute float aDefinedNext;

        varying float vDefined;
        
        float when_lt(float a, float b) {
            return max(sign(b - a), 0.0);
        }
        
        float and(float a, float b) {
            return a * b;
        }`,body:`
        vDefined = aDefined * aDefinedNext;
        gl_Position = vec4(0, 0, 0, 1);

        float hasIntercepted = when_lt((aMainValue - aBaseValue) * (aMainPrevValue - aBasePrevValue), 0.0);
        float useIntercept = and(aCorner.z, hasIntercepted);
        
        float yGradient = (aMainValue - aMainPrevValue) / (aCrossValue - aCrossPrevValue);
        float yConstant = aMainValue - (yGradient * aCrossValue);

        float y0Gradient = (aBaseValue - aBasePrevValue) / (aCrossValue - aCrossPrevValue);
        float y0Constant = aBaseValue - (y0Gradient * aCrossValue);

        float denominator = (yGradient - y0Gradient) + step(abs(yGradient - y0Gradient), 0.0);
        float interceptXValue = (y0Constant - yConstant) / denominator;
        float interceptYValue = (yGradient * interceptXValue) + yConstant;

        gl_Position = vec4(interceptXValue * useIntercept, interceptYValue * useIntercept, 0, 1);
        
        gl_Position.x += (1.0 - useIntercept) * ((aCorner.x * aCrossValue) + ((1.0 - aCorner.x) * aCrossPrevValue));
        gl_Position.y += (1.0 - useIntercept) * (1.0 - aCorner.y) * ((aCorner.x * aMainValue) + ((1.0 - aCorner.x) * aMainPrevValue));
        gl_Position.y += (1.0 - useIntercept) * aCorner.y * ((aCorner.x * aBaseValue) + ((1.0 - aCorner.x) * aBasePrevValue));`},Z={header:`
        attribute vec4 aCorner;
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aCapWidth;
        attribute float aHighValue;
        attribute float aUpperQuartileValue;
        attribute float aMedianValue;
        attribute float aLowerQuartileValue;
        attribute float aLowValue;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;
        
        varying float vDefined;`,body:`
        vDefined = aDefined;
        float isExtremeY = sign(abs(aCorner.y) - 2.0) + 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;

        float isNonZeroY = abs(sign(aCorner.y));
        float isZeroY = 1.0 - isNonZeroY;

        float isQuartileY = isNotExtremeY * isNonZeroY;

        float isPositiveY = (sign(aCorner.y + 0.5) + 1.0) / 2.0;
        float isNegativeY = 1.0 - isPositiveY;

        float yValue =
          (isExtremeY * isNegativeY) * aHighValue +
          (isQuartileY * isNegativeY) * aUpperQuartileValue +
          isZeroY * aMedianValue +
          (isQuartileY * isPositiveY) * aLowerQuartileValue +
          (isExtremeY * isPositiveY) * aLowValue;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);

        float isHorizontal = aCorner.w;
        float isVertical = 1.0 - isHorizontal;

        float xDisplacement = aCorner.x * (isExtremeY * aCapWidth + isNotExtremeY * aBandwidth) / 2.0;
        
        float xModifier = (isVertical * uStrokeWidth * aCorner.z / 2.0) + xDisplacement;
        float yModifier = isHorizontal * uStrokeWidth * aCorner.z / 2.0;`},$={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        float distance = length(2.0 * gl_PointCoord - 1.0);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
            return;
        }`},ee={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float distance = max(abs(pointCoordTransform.x), abs(pointCoordTransform.y));`},te={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float topEdgesDistance = abs(pointCoordTransform.x) - ((pointCoordTransform.y - 0.6) / sqrt(3.0));
        float bottomEdgeDistance = pointCoordTransform.y + 0.5;
        float distance = max(topEdgesDistance, bottomEdgeDistance);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
        }`},ae={header:`
        varying float vSize;
        varying float vStrokeWidthRatio;
        varying float vDefined;`,body:`
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float innerCornerDistance = min(abs(pointCoordTransform.x), abs(pointCoordTransform.y)) + 0.66 - vStrokeWidthRatio;
        float outerEdgeDistance = max(abs(pointCoordTransform.x), abs(pointCoordTransform.y));
        float distance = max(innerCornerDistance, outerEdgeDistance);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
        }`},ne={header:`
        varying float vColorIndicator;
        varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.4, 0.8, 0, 1);
        if (vColorIndicator < 0.0) {
            gl_FragColor = vec4(0.8, 0.4, 0, 1);
        }`},ie={header:`
        varying float vColorIndicator;
        varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.4, 0.8, 0, 1);
        if (vColorIndicator < 0.0) {
            gl_FragColor = vec4(0.8, 0.4, 0, 1);
        }`},re={header:`
        varying float vDefined;`,body:`if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.86, 0.86, 0.86, 1);`},le={header:`varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }`},de={header:`varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }`},oe={header:`varying float vDefined;`,body:`
        if (vDefined < 0.5) {
            discard;
        }`},se={header:`varying float vDefined;`,body:`if (vDefined < 0.5) {
        discard;
    }`};var ue=()=>{const e=C(z),t=C(Y);return e.appendHeader(J.header).appendBody(J.body),t.appendHeader(re.header).appendBody(re.body),{vertex:()=>e,fragment:()=>t}};const ce={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126};var he=()=>{let e=-1,t=null,a=1,n=ce.FLOAT,i=!1,r=0,l=0,d=0;const o=o=>{const s=o.context();null!=t&&s.isBuffer(t)||(t=s.createBuffer()),s.bindBuffer(s.ARRAY_BUFFER,t),s.vertexAttribPointer(e,a,n,i,r,l),s.enableVertexAttribArray(e);const u=s.getExtension("ANGLE_instanced_arrays");u.vertexAttribDivisorANGLE(e,d)};return o.location=(...t)=>t.length?(e=t[0],o):e,o.buffer=(...e)=>e.length?(t=e[0],o):t,o.size=(...e)=>e.length?(a=e[0],o):a,o.type=(...e)=>e.length?(n=e[0],o):n,o.normalized=(...e)=>e.length?(i=e[0],o):i,o.stride=(...e)=>e.length?(r=e[0],o):r,o.offset=(...e)=>e.length?(l=e[0],o):l,o.divisor=(...e)=>e.length?(d=e[0],o):d,o},fe=()=>{let e=ce.FLOAT,t=new Float32Array(0);const a=a=>{const n=o(e);return t.length>a?t=new n(t.buffer,0,a):t.length!==a&&(t=new n(a)),t};return a.type=(...n)=>{if(!n.length)return e;if(e!==n[0]){e=n[0];const a=o(e);t=new a(0)}return a},a},ge=()=>{let e=!0,t=1,a=ce.FLOAT,n=fe(),r=e=>e,l=null;const d=()=>{const d=l.length,o=n.type(a)(d*t);if(1<t)for(let e=0;e<d;e++){const a=r(l[e],e);if(a.length!==t)throw new Error(`Expected components array of size ${t}, recieved array with length ${a.length}.`);for(let n=0;n<t;n++)o[e*t+n]=a[n]}else for(let e=0;e<d;e++){const t=r(l[e],e);if(Array.isArray(t))throw new Error(`Expected a single component value, recieved array with length ${t.length}.`);o[e]=t}return e=!1,o};return d.dirty=()=>e,d.size=(...a)=>a.length?(t=a[0],e=!0,d):t,d.type=(...t)=>t.length?(a=t[0],e=!0,d):a,d.arrayViewFactory=(...t)=>t.length?(n=t[0],e=!0,d):n,d.value=(...t)=>t.length?(r=t[0],e=!0,d):r,d.data=(...t)=>t.length?(l=t[0],e=!0,d):l,d},be=()=>{const e=he(),t=ge(),a=n=>{if(e.size(a.size()).type(a.type()),e(n),!t.dirty())return;const i=t(),r=n.context();r.bindBuffer(r.ARRAY_BUFFER,e.buffer()),r.bufferData(r.ARRAY_BUFFER,i,r.DYNAMIC_DRAW)};return v(a,e,"normalized","location"),v(a,t,"data","value","size","type"),a},pe=e=>{let t=null,a=e,n=!0;const i=e=>{const i=e.context();null!=t&&i.isBuffer(t)||(t=i.createBuffer()),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),n&&(i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),i.STATIC_DRAW),n=!1)};return i.data=(...e)=>e.length?(n=!0,a=e[0],i):a,i},ye=(e,t,a,n,...i)=>{e[t]=(...t)=>{const r=a[n](...i,...t);return r===a?e:r}},Se=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k(),n=()=>{};const i=be().size(3).type(ce.UNSIGNED_BYTE).data([[0,0,0],[0,1,0],[1,1,1],[0,0,1],[1,0,0],[1,1,0]]);e.buffers().elementIndices(pe([0,1,2,3,4,5])).attribute("aCorner",i);const r=i=>{const r=ue();e.vertexShader(r.vertex()).fragmentShader(r.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),n(e),e(i-1)};return r.decorate=(...e)=>e.length?(n=e[0],r):n,r.xScale=(...e)=>e.length?(t=e[0],r):t,r.yScale=(...e)=>e.length?(a=e[0],r):a,v(r,e,"context"),ye(r,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(r,"crossPreviousValueAttribute",e.buffers(),"attribute","aCrossPrevValue"),ye(r,"mainValueAttribute",e.buffers(),"attribute","aMainValue"),ye(r,"mainPreviousValueAttribute",e.buffers(),"attribute","aMainPrevValue"),ye(r,"baseValueAttribute",e.buffers(),"attribute","aBaseValue"),ye(r,"basePreviousValueAttribute",e.buffers(),"attribute","aBasePrevValue"),ye(r,"definedAttribute",e.buffers(),"attribute","aDefined"),ye(r,"definedNextAttribute",e.buffers(),"attribute","aDefinedNext"),r},ve=()=>{const e=C(z),t=C(Y);return e.appendHeader(U.header).appendBody(U.body),t.appendHeader($.header).appendBody($.body),{vertex:()=>e,fragment:()=>t}},me=()=>{const e=L().mode(G.POINTS),t=be().data([0]);e.buffers().attribute("aIgnored",t).elementIndices(pe([0]));let a=k(),n=k(),i=ve(),r=()=>{};const l=t=>{e.vertexShader(i.vertex().appendHeader("attribute float aIgnored;").appendBody("gl_Position += aIgnored;")).fragmentShader(i.fragment()),a(e,"gl_Position",0),n(e,"gl_Position",1),r(e),e(t)};return l.type=(...e)=>e.length?(i=e[0],l):i,l.decorate=(...e)=>e.length?(r=e[0],l):r,l.xScale=(...e)=>e.length?(a=e[0],l):a,l.yScale=(...e)=>e.length?(n=e[0],l):n,v(l,e,"context"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"mainValueAttribute",e.buffers(),"attribute","aMainValue"),ye(l,"sizeAttribute",e.buffers(),"attribute","aSize"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),l},xe=()=>{const e=C(z),t=C(Y);return e.appendHeader(X.header).appendBody(X.body),t.appendHeader(se.header).appendBody(se.body),{vertex:()=>e,fragment:()=>t}},Ae=()=>{let e=1;const t=t=>{t.buffers().uniform("uStrokeWidth",D(e))};return t.lineWidth=(...a)=>a.length?(e=a[0],t):e,t},Ve=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k(),n=()=>{};const i=Ae(),r=be().size(3).type(ce.BYTE).data([[-1,0,0],[1,1,0],[1,-1,1],[-1,0,1],[1,1,1]]);e.buffers().elementIndices(pe([0,1,2,1,2,3,0,2,3,2,3,4])).attribute("aCorner",r);const l=r=>{const l=xe();e.vertexShader(l.vertex()).fragmentShader(l.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),t(e,"next",0),a(e,"next",1),t(e,"prev",0),a(e,"prev",1),t(e,"prevPrev",0),a(e,"prevPrev",1),e.vertexShader().appendBody(j.body),i(e),n(e),e(r-1)};return l.decorate=(...e)=>e.length?(n=e[0],l):n,l.xScale=(...e)=>e.length?(t=e[0],l):t,l.yScale=(...e)=>e.length?(a=e[0],l):a,v(l,e,"context"),v(l,i,"lineWidth"),ye(l,"crossPreviousValueAttribute",e.buffers(),"attribute","aCrossPrevValue"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"crossNextValueAttribute",e.buffers(),"attribute","aCrossNextValue"),ye(l,"crossPreviousPreviousValueAttribute",e.buffers(),"attribute","aCrossPrevPrevValue"),ye(l,"mainPreviousValueAttribute",e.buffers(),"attribute","aMainPrevValue"),ye(l,"mainValueAttribute",e.buffers(),"attribute","aMainValue"),ye(l,"mainNextValueAttribute",e.buffers(),"attribute","aMainNextValue"),ye(l,"mainPreviousPreviousValueAttribute",e.buffers(),"attribute","aMainPrevPrevValue"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),ye(l,"definedNextAttribute",e.buffers(),"attribute","aDefinedNext"),l},we=()=>{const e=C(z),t=C(Y);return e.appendHeader(M.header).appendBody(M.body),t.appendHeader(ie.header).appendBody(ie.body),{vertex:()=>e,fragment:()=>t}},Te=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k();const n=Ae();let i=()=>{};const r=be().size(3).type(ce.BYTE).data([[0,-2,-1],[0,-2,1],[0,2,1],[0,2,-1],[-1,-1,-1],[-1,-1,1],[0,-1,1],[0,-1,-1],[1,1,1],[0,1,1],[0,1,-1],[1,1,-1]]);e.buffers().elementIndices(pe([0,1,2,0,3,2,4,5,6,4,7,6,8,9,10,10,11,8])).attribute("aCorner",r);const l=r=>{const l=we();e.vertexShader(l.vertex()).fragmentShader(l.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),n(e),e.vertexShader().appendBody(`
          gl_Position.x += xModifier / uScreen.x;
          gl_Position.y += yModifier / uScreen.y;
        `),i(e),e(r)};return l.decorate=(...e)=>e.length?(i=e[0],l):i,l.xScale=(...e)=>e.length?(t=e[0],l):t,l.yScale=(...e)=>e.length?(a=e[0],l):a,v(l,e,"context"),v(l,n,"lineWidth"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"openValueAttribute",e.buffers(),"attribute","aOpenValue"),ye(l,"highValueAttribute",e.buffers(),"attribute","aHighValue"),ye(l,"lowValueAttribute",e.buffers(),"attribute","aLowValue"),ye(l,"closeValueAttribute",e.buffers(),"attribute","aCloseValue"),ye(l,"bandwidthAttribute",e.buffers(),"attribute","aBandwidth"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),l},Ee=()=>{const e=C(z),t=C(Y);return e.appendHeader(q.header).appendBody(q.body),t.appendHeader(oe.header).appendBody(oe.body),{vertex:()=>e,fragment:()=>t}},Ne=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k(),n=()=>{};const i=be().size(2).type(ce.BYTE).data([[-1,-1],[1,1],[-1,1],[1,-1]]);e.buffers().elementIndices(pe([0,1,2,0,1,3])).attribute("aCorner",i);const r=i=>{const r=Ee();e.vertexShader(r.vertex()).fragmentShader(r.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),e.vertexShader().appendBody(`
            gl_Position.x += xModifier / uScreen.x * 2.0;
        `),n(e),e(i)};return r.decorate=(...e)=>e.length?(n=e[0],r):n,r.xScale=(...e)=>e.length?(t=e[0],r):t,r.yScale=(...e)=>e.length?(a=e[0],r):a,v(r,e,"context"),ye(r,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(r,"mainValueAttribute",e.buffers(),"attribute","aMainValue"),ye(r,"baseValueAttribute",e.buffers(),"attribute","aBaseValue"),ye(r,"bandwidthAttribute",e.buffers(),"attribute","aBandwidth"),ye(r,"definedAttribute",e.buffers(),"attribute","aDefined"),r},Ie=()=>{const e=C(z),t=C(Y);return e.appendHeader(K.header).appendBody(K.body),t.appendHeader(de.header).appendBody(de.body),{vertex:()=>e,fragment:()=>t}},Be=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k(),n=()=>{};const i=Ae(),r=be().size(3).type(ce.BYTE).data([[0,1,1],[0,1,-1],[0,-1,-1],[0,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,1,1],[1,1,-1]]);e.buffers().elementIndices(pe([0,1,2,0,3,2,4,5,6,4,7,6,8,9,10,8,11,10])).attribute("aCorner",r);const l=r=>{const l=Ie();e.vertexShader(l.vertex()).fragmentShader(l.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),i(e),e.vertexShader().appendBody(`
                gl_Position.x += xModifier / uScreen.x * 2.0;
                gl_Position.y += yModifier / uScreen.y * 2.0;
            `),n(e),e(r)};return l.decorate=(...e)=>e.length?(n=e[0],l):n,l.xScale=(...e)=>e.length?(t=e[0],l):t,l.yScale=(...e)=>e.length?(a=e[0],l):a,v(l,e,"context"),v(l,i,"lineWidth"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"highValueAttribute",e.buffers(),"attribute","aHighValue"),ye(l,"lowValueAttribute",e.buffers(),"attribute","aLowValue"),ye(l,"bandwidthAttribute",e.buffers(),"attribute","aBandwidth"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),l},Pe=()=>{const e=C(z),t=C(Y);return e.appendHeader(W.header).appendBody(W.body),t.appendHeader(ne.header).appendBody(ne.body),{vertex:()=>e,fragment:()=>t}},Re=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k();const n=Ae();let i=()=>{};const r=be().size(3).type(ce.BYTE).data([[0,2,1],[0,2,-1],[0,-2,-1],[0,-2,1],[1,-1,0],[-1,-1,0],[-1,1,0],[1,1,0]]);e.buffers().elementIndices(pe([0,1,2,0,3,2,4,5,6,4,7,6])).attribute("aCorner",r);const l=r=>{const l=Pe();e.vertexShader(l.vertex()).fragmentShader(l.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),n(e),e.vertexShader().appendBody(`
          gl_Position.x += xModifier / uScreen.x;
          gl_Position.y += yModifier / uScreen.y;
        `),i(e),e(r)};return l.decorate=(...e)=>e.length?(i=e[0],l):i,l.xScale=(...e)=>e.length?(t=e[0],l):t,l.yScale=(...e)=>e.length?(a=e[0],l):a,v(l,e,"context"),v(l,n,"lineWidth"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"openValueAttribute",e.buffers(),"attribute","aOpenValue"),ye(l,"highValueAttribute",e.buffers(),"attribute","aHighValue"),ye(l,"lowValueAttribute",e.buffers(),"attribute","aLowValue"),ye(l,"closeValueAttribute",e.buffers(),"attribute","aCloseValue"),ye(l,"bandwidthAttribute",e.buffers(),"attribute","aBandwidth"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),l},_e=()=>{const e=C(z),t=C(Y);return e.appendHeader(Z.header).appendBody(Z.body),t.appendHeader(le.header).appendBody(le.body),{vertex:()=>e,fragment:()=>t}},ke=()=>{const e=L().mode(G.TRIANGLES);let t=k(),a=k(),n=()=>{};const i=Ae(),r=be().size(4).type(ce.BYTE).data([[-1,-2,-1,1],[1,-2,-1,1],[1,-2,1,1],[-1,-2,1,1],[0,-2,-1,0],[0,-2,1,0],[0,-1,1,0],[0,-1,-1,0],[-1,-1,-1,1],[1,-1,-1,1],[1,-1,1,1],[-1,-1,1,1],[-1,0,-1,1],[1,0,-1,1],[1,0,1,1],[-1,0,1,1],[-1,1,-1,1],[1,1,-1,1],[1,1,1,1],[-1,1,1,1],[-1,-1,-1,0],[-1,-1,1,0],[-1,1,1,0],[-1,1,-1,0],[1,-1,-1,0],[1,-1,1,0],[1,1,1,0],[1,1,-1,0],[0,2,-1,0],[0,2,1,0],[0,1,1,0],[0,1,-1,0],[-1,2,-1,1],[1,2,-1,1],[1,2,1,1],[-1,2,1,1]]);e.buffers().elementIndices(pe([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23,24,25,26,24,26,27,28,29,30,28,30,31,32,33,34,32,34,35])).attribute("aCorner",r);const l=r=>{const l=_e();e.vertexShader(l.vertex()).fragmentShader(l.fragment()),t(e,"gl_Position",0),a(e,"gl_Position",1),i(e),e.vertexShader().appendBody(`
            gl_Position.x += xModifier / uScreen.x * 2.0;
            gl_Position.y += yModifier / uScreen.y * 2.0;
        `),n(e),e(r)};return l.decorate=(...e)=>e.length?(n=e[0],l):n,l.xScale=(...e)=>e.length?(t=e[0],l):t,l.yScale=(...e)=>e.length?(a=e[0],l):a,v(l,e,"context"),v(l,i,"lineWidth"),ye(l,"crossValueAttribute",e.buffers(),"attribute","aCrossValue"),ye(l,"highValueAttribute",e.buffers(),"attribute","aHighValue"),ye(l,"upperQuartileValueAttribute",e.buffers(),"attribute","aUpperQuartileValue"),ye(l,"medianValueAttribute",e.buffers(),"attribute","aMedianValue"),ye(l,"lowerQuartileValueAttribute",e.buffers(),"attribute","aLowerQuartileValue"),ye(l,"lowValueAttribute",e.buffers(),"attribute","aLowValue"),ye(l,"bandwidthAttribute",e.buffers(),"attribute","aBandwidth"),ye(l,"capAttribute",e.buffers(),"attribute","aCapWidth"),ye(l,"definedAttribute",e.buffers(),"attribute","aDefined"),l},He=(e=0,t=0)=>{if(0<e||0>t)throw new Error(`Offset values (${e} & ${t}) must straddle 0 `);const a=he().divisor(1),n=ge(),i=r=>{const l=i.size()*d(i.type()),o=f(e)*l;if(a.offset(o).size(i.size()).type(i.type()),a(r),!n.dirty())return;const s=n(),u=o+s.length*d(i.type())+t*l,c=r.context();c.bindBuffer(c.ARRAY_BUFFER,a.buffer()),c.bufferData(c.ARRAY_BUFFER,u,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,o,s)};return i.offset=n=>{if(e>n||n>t)throw new Error(`Requested offset ${n} exceeds bounds (${e} & ${t}) `);const r=t=>{a.offset((n-e)*i.size()*d(i.type())),a(t)};return v(r,a,"location"),r},v(i,a,"normalized","location"),v(i,n,"data","value","size","type"),i},De=()=>{const e=he().divisor(1),t=ge(),a=n=>{if(e.size(a.size()).type(a.type()),e(n),!t.dirty())return;const i=t(),r=n.context();r.bindBuffer(r.ARRAY_BUFFER,e.buffer()),r.bufferData(r.ARRAY_BUFFER,i,r.DYNAMIC_DRAW)};return v(a,e,"normalized","location"),v(a,t,"data","value","size","type"),a},Ge=()=>{const e=k(),t=e=>`linear${e}`,a=(a,n,i)=>{a.vertexShader().appendHeaderIfNotExists(`uniform vec4 ${t(i)}Offset;`).appendHeaderIfNotExists(`uniform vec4 ${t(i)}Scale;`).appendBody(`${n} = ${n} + ${t(i)}Offset;`).appendBody(`${n} = ${n} * ${t(i)}Scale;`);const r=e.domain()[1]-e.domain()[0],l=e.range()[1]-e.range()[0],d=e.range()[0]*(r/l)-e.domain()[0],o=[0,0,0,0],s=[1,1,1,1];o[i]=d,s[i]=l/r,a.buffers().uniform(`${t(i)}Offset`,D(o)).uniform(`${t(i)}Scale`,D(s))};return x(a,e),a},Le=()=>{function e(e,t){var a=Math.log10;return a(e)/a(t)}const t=k();let a=10;const n=e=>`log${e}`,i=(i,r,l)=>{const d=`${n(l)}Offset + (${n(l)}Scale * clamp(log(${r}) / log(${n(l)}Base), -inf, inf))`;i.vertexShader().appendHeaderIfNotExists(`uniform vec4 ${n(l)}Offset;`).appendHeaderIfNotExists(`uniform vec4 ${n(l)}Scale;`).appendHeaderIfNotExists(`uniform vec4 ${n(l)}Include;`).appendHeaderIfNotExists(`uniform float ${n(l)}Base;`).appendBody(`${r} = (${n(l)}Include * (${d})) + ((1.0 - ${n(l)}Include) * ${r});`);const o=e(t.domain()[1],a)-e(t.domain()[0],a),s=t.range()[1]-t.range()[0],u=s/o,c=t.range()[0]-u*e(t.domain()[0],a),h=[0,0,0,0],f=[0,0,0,0],g=[0,0,0,0];h[l]=c,f[l]=u,g[l]=1,i.buffers().uniform(`${n(l)}Offset`,D(h)).uniform(`${n(l)}Scale`,D(f)).uniform(`${n(l)}Include`,D(g)).uniform(`${n(l)}Base`,D(a))};return i.base=(...e)=>e.length?(a=e[0],i):a,x(i,t),i},Ce=()=>{function e(t,a){var e=Math.pow,n=Math.sign;return n(t)*e(f(t),a)}const t=k();let a=1;const n=e=>`pow${e}`,i=(i,r,l)=>{const d=`${n(l)}Offset + (${n(l)}Scale * sign(${r}) * pow(abs(${r}), vec4(${n(l)}Exp)))`;i.vertexShader().appendHeaderIfNotExists(`uniform vec4 ${n(l)}Offset;`).appendHeaderIfNotExists(`uniform vec4 ${n(l)}Scale;`).appendHeaderIfNotExists(`uniform vec4 ${n(l)}Include;`).appendHeaderIfNotExists(`uniform float ${n(l)}Exp;`).appendBody(`${r} = (${n(l)}Include * (${d})) + ((1.0 - ${n(l)}Include) * ${r});`);const o=e(t.domain()[1],a)-e(t.domain()[0],a),s=t.range()[1]-t.range()[0],u=s/o,c=t.range()[0]-u*e(t.domain()[0],a),h=[0,0,0,0],f=[0,0,0,0],g=[0,0,0,0];h[l]=c,f[l]=u,g[l]=1,i.buffers().uniform(`${n(l)}Offset`,D(h)).uniform(`${n(l)}Scale`,D(f)).uniform(`${n(l)}Include`,D(g)).uniform(`${n(l)}Exp`,D(a))};return i.exponent=(...e)=>e.length?(a=e[0],i):a,x(i,t),i},ze=e=>{let t=b.scaleIdentity(),a=null;const n=e.copy.toString();return n===b.scaleLinear().copy.toString()?a=Ge().domain(e.domain()):n===b.scaleLog().copy.toString()?a=Le().domain(e.domain()).base(e.base()):n===b.scalePow().copy.toString()?a=Ce().domain(e.domain()).exponent(e.exponent()):n===b.scaleTime().copy.toString()?a=Ge().domain(e.domain()):(a=Ge().domain(e.range()),t=e),{scale:t,glScale:a}},Ye=()=>{const e=C(z),t=C(Y);return e.appendHeader(O.header).appendBody(O.body),t.appendHeader(ee.header).appendBody(ee.body),{vertex:()=>e,fragment:()=>t}},Ue=()=>{const e=C(z),t=C(Y);return e.appendHeader(F.header).appendBody(F.body),t.appendHeader(te.header).appendBody(te.body),{vertex:()=>e,fragment:()=>t}},Oe=()=>{const e=C(z),t=C(Y);return e.appendHeader(Q.header).appendBody(Q.body),t.appendHeader(ae.header).appendBody(ae.body),{vertex:()=>e,fragment:()=>t}},Fe=e=>{switch(e){case g.symbolCircle:return ve();case g.symbolSquare:return Ye();case g.symbolTriangle:return Ue();case g.symbolCross:return Oe();default:throw new Error(`Unrecognised symbol: ${e}`);}},Qe=e=>"function"==typeof e?e:()=>e,We=()=>{let e=null,t=e=>e.date,a=e=>e.open,n=e=>e.high,r=e=>e.low,l=e=>e.close,o="vertical",s=Qe(3);const u=function(d){const u=e||i.path();return d.forEach(function(e,d){const i=t(e,d),c=a(e,d),h=n(e,d),f=r(e,d),g=l(e,d),b=s(e,d)/2;"vertical"===o?(u.moveTo(i,f),u.lineTo(i,h),u.moveTo(i,c),u.lineTo(i-b,c),u.moveTo(i,g),u.lineTo(i+b,g)):(u.moveTo(f,i),u.lineTo(h,i),u.moveTo(c,i),u.lineTo(c,i+b),u.moveTo(g,i),u.lineTo(g,i-b))}),e?null:u.toString()};return u.context=(...t)=>t.length?(e=t[0],u):e,u.x=(...e)=>e.length?(t=Qe(e[0]),u):t,u.open=(...e)=>e.length?(a=Qe(e[0]),u):a,u.high=(...e)=>e.length?(n=Qe(e[0]),u):n,u.low=(...e)=>e.length?(r=Qe(e[0]),u):r,u.close=(...e)=>e.length?(l=Qe(e[0]),u):l,u.width=(...e)=>e.length?(s=Qe(e[0]),u):s,u.orient=(...e)=>e.length?(o=e[0],u):o,u},Me=()=>{let e=null,t=e=>e.x,a=e=>e.y,n="center",r="center",l=e=>e.height,o=Qe(3);const s=function(d,s){const u=e||i.path();return d.forEach(function(e,d){const i=t.call(this,e,s||d),c=a.call(this,e,s||d),h=l.call(this,e,s||d),f=o.call(this,e,s||d);let g;switch(n){case"left":g=f;break;case"right":g=0;break;case"center":g=f/2;break;default:throw new Error("Invalid horizontal alignment "+n);}let b;switch(r){case"bottom":b=-h;break;case"top":b=0;break;case"center":b=h/2;break;default:throw new Error("Invalid vertical alignment "+r);}u.rect(i-g,c-b,f,h)},this),e?null:u.toString()};return s.context=(...t)=>t.length?(e=t[0],s):e,s.x=(...e)=>e.length?(t=Qe(e[0]),s):t,s.y=(...e)=>e.length?(a=Qe(e[0]),s):a,s.width=(...e)=>e.length?(o=Qe(e[0]),s):o,s.horizontalAlign=(...e)=>e.length?(n=e[0],s):n,s.height=(...e)=>e.length?(l=Qe(e[0]),s):l,s.verticalAlign=(...e)=>e.length?(r=e[0],s):r,s},qe=()=>{let e=null,t=e=>e.date,a=e=>e.open,n=e=>e.high,r=e=>e.low,l=e=>e.close,o=Qe(3);const s=function(d){const s=e||i.path();return d.forEach(function(e,d){var i=Math.max,u=Math.min;const c=t(e,d),h=a(e,d),f=n(e,d),g=r(e,d),b=l(e,d),p=o(e,d);s.rect(c-p/2,h,p,b-h),s.moveTo(c,u(b,h)),s.lineTo(c,f),s.moveTo(c,i(b,h)),s.lineTo(c,g)}),e?null:s.toString()};return s.context=(...t)=>t.length?(e=t[0],s):e,s.x=(...e)=>e.length?(t=Qe(e[0]),s):t,s.open=(...e)=>e.length?(a=Qe(e[0]),s):a,s.high=(...e)=>e.length?(n=Qe(e[0]),s):n,s.low=(...e)=>e.length?(r=Qe(e[0]),s):r,s.close=(...e)=>e.length?(l=Qe(e[0]),s):l,s.width=(...e)=>e.length?(o=Qe(e[0]),s):o,s},Xe=()=>{let e=null,t=e=>e.value,a=e=>e.median,n=e=>e.upperQuartile,r=e=>e.lowerQuartile,l=e=>e.high,o=e=>e.low,s="vertical",u=Qe(5),c=Qe(.5);const h=function(d){const h=e||i.path();return d.forEach(function(e,d){const i=t(e,d),f=u(e,d),g=f/2,b=f*c(e,d),p=b/2,y=l(e,d),S=n(e,d),v=a(e,d),m=r(e,d),x=o(e,d),A=m-S;"vertical"===s?(h.moveTo(i-p,y),h.lineTo(i+p,y),h.moveTo(i,y),h.lineTo(i,S),h.rect(i-g,S,f,A),h.moveTo(i-g,v),h.lineTo(i+g,v),h.moveTo(i,m),h.lineTo(i,x),h.moveTo(i-p,x),h.lineTo(i+p,x)):(h.moveTo(x,i-p),h.lineTo(x,i+p),h.moveTo(x,i),h.lineTo(m,i),h.rect(m,i-g,-A,f),h.moveTo(v,i-g),h.lineTo(v,i+g),h.moveTo(S,i),h.lineTo(y,i),h.moveTo(y,i-p),h.lineTo(y,i+p))}),e?null:h.toString()};return h.context=(...t)=>t.length?(e=t[0],h):e,h.value=(...e)=>e.length?(t=Qe(e[0]),h):t,h.median=(...e)=>e.length?(a=Qe(e[0]),h):a,h.upperQuartile=(...e)=>e.length?(n=Qe(e[0]),h):n,h.lowerQuartile=(...e)=>e.length?(r=Qe(e[0]),h):r,h.high=(...e)=>e.length?(l=Qe(e[0]),h):l,h.low=(...e)=>e.length?(o=Qe(e[0]),h):o,h.width=(...e)=>e.length?(u=Qe(e[0]),h):u,h.orient=(...e)=>e.length?(s=e[0],h):s,h.cap=(...e)=>e.length?(c=Qe(e[0]),h):c,h},je=()=>{let e=null,t=e=>e.x,a=e=>e.high,n=e=>e.low,r="vertical",l=Qe(5);const d=function(d){const o=e||i.path();return d.forEach(function(e,d){const i=t(e,d),s=l(e,d),u=s/2,c=a(e,d),h=n(e,d);"vertical"===r?(o.moveTo(i-u,c),o.lineTo(i+u,c),o.moveTo(i,c),o.lineTo(i,h),o.moveTo(i-u,h),o.lineTo(i+u,h)):(o.moveTo(h,i-u),o.lineTo(h,i+u),o.moveTo(h,i),o.lineTo(c,i),o.moveTo(c,i-u),o.lineTo(c,i+u))}),e?null:o.toString()};return d.context=(...t)=>t.length?(e=t[0],d):e,d.value=(...e)=>e.length?(t=Qe(e[0]),d):t,d.high=(...e)=>e.length?(a=Qe(e[0]),d):a,d.low=(...e)=>e.length?(n=Qe(e[0]),d):n,d.width=(...e)=>e.length?(l=Qe(e[0]),d):l,d.orient=(...e)=>e.length?(r=e[0],d):r,d},Ke=function(){var e=function(e){return e.high},t=function(e){return e.low},a=function(e){return e.cross},r="vertical",o="center",s=function(){return 5},u=N({decorate:function(){},defined:function(n,r){return l(t,e,a)(n,r)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return u.values=function(n,l){var i=s(n,l),d=E(o,i),c=u.xScale(),h=u.yScale();if("vertical"===r){var f=h(e(n,l));return{origin:[c(a(n,l))+d,f],high:0,low:h(t(n,l))-f,width:i}}var g=c(t(n,l));return{origin:[g,h(a(n,l))+d],high:c(e(n,l))-g,low:0,width:i}},u.xValues=function(){return"vertical"===r?[a]:[e,t]},u.yValues=function(){return"vertical"===r?[e,t]:[a]},u.orient=function(){return arguments.length?(r=0>=arguments.length?void 0:arguments[0],u):r},u.lowValue=function(){return arguments.length?(t=T(0>=arguments.length?void 0:arguments[0]),u):t},u.highValue=function(){return arguments.length?(e=T(0>=arguments.length?void 0:arguments[0]),u):e},u.crossValue=function(){return arguments.length?(a=T(0>=arguments.length?void 0:arguments[0]),u):a},u.bandwidth=function(){return arguments.length?(s=T(0>=arguments.length?void 0:arguments[0]),u):s},u.align=function(){return arguments.length?(o=0>=arguments.length?void 0:arguments[0],u):o},u},Je=function(){var e,t=function(e){return e.date},a=function(e){return e.open},r=function(e){return e.high},o=function(e){return e.low},s=function(e){return e.close},u=function(){return 5},c="center",h=function(a,n){return e.xScale()(t(a,n))};return e=N({decorate:function(){},defined:function(e,n){return l(t,a,o,r,s)(e,n)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()}),e.values=function(t,n){var i=s(t,n),l=a(t,n),d=u(t,n),f=E(c,d),g="";return i>l?g="up":i<l&&(g="down"),{cross:h(t,n)+f,open:e.yScale()(l),high:e.yScale()(r(t,n)),low:e.yScale()(o(t,n)),close:e.yScale()(i),width:d,direction:g}},e.xValues=function(){return[t]},e.yValues=function(){return[a,r,o,s]},e.crossValue=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],e):t},e.openValue=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],e):a},e.highValue=function(){return arguments.length?(r=0>=arguments.length?void 0:arguments[0],e):r},e.lowValue=function(){return arguments.length?(o=0>=arguments.length?void 0:arguments[0],e):o},e.yValue=e.closeValue=function(){return arguments.length?(s=0>=arguments.length?void 0:arguments[0],e):s},e.bandwidth=function(){return arguments.length?(u=T(0>=arguments.length?void 0:arguments[0]),e):u},e.align=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],e):c},e},Ze=function(e,t){var n=Je(),i=y("g",t),r=function(e){return"translate("+e.cross+", "+e.high+")"},l=function(e){return function(t){return e.selection?t.transition(e):t}},d=function(d){d.selection&&i.transition(d);var o=l(d);d.each(function(l,d,s){var u=l.filter(n.defined()),c=i(a.select(s[d]),u);c.enter().attr("transform",function(e,t){return r(n.values(e,t))+" scale(1e-6, 1)"}).append("path"),c.each(function(l,d,i){var s=n.values(l,d),u="up"===s.direction?B.green:B.red,c=o(a.select(i[d])).attr("class",t+" "+s.direction).attr("stroke",u).attr("fill",u).attr("transform",function(){return r(s)+" scale(1)"});e.x(0).width(s.width).open(function(){return s.open-s.high}).high(0).low(function(){return s.low-s.high}).close(function(){return s.close-s.high}),c.select("path").attr("d",e([l]))}),n.decorate()(c,l,d)})};return v(d,i,"key"),x(d,n),d},$e=function(e){var t=Je(),a=function(a){var n=a.filter(t.defined()),r=e.context();n.forEach(function(a,n){r.save();var i=t.values(a,n);r.translate(i.cross,i.high),r.beginPath(),e.x(0).open(function(){return i.open-i.high}).width(i.width).high(0).low(function(){return i.low-i.high}).close(function(){return i.close-i.high})([a]);var l="up"===i.direction?B.green:B.red;r.strokeStyle=l,r.fillStyle=l,t.decorate()(r,a,n),r.fill(),r.stroke(),r.closePath(),r.restore()})};return v(a,e,"context"),x(a,t),a},et=function(e){var t=Je(),a=De(),n=De(),i=De(),r=De(),l=De(),d=De().type(ce.UNSIGNED_SHORT),o=De().type(ce.UNSIGNED_BYTE);e.crossValueAttribute(a).openValueAttribute(n).highValueAttribute(i).lowValueAttribute(r).closeValueAttribute(l).bandwidthAttribute(d).definedAttribute(o);var s=function(){return!1},u=[],c=function(c){var h=ze(t.xScale()),f=ze(t.yScale());_(h.scale)&&_(f.scale)&&s(u,c)||(u=c,a.value(function(e,a){return h.scale(t.crossValue()(e,a))}).data(c),n.value(function(e,a){return f.scale(t.openValue()(e,a))}).data(c),i.value(function(e,a){return f.scale(t.highValue()(e,a))}).data(c),r.value(function(e,a){return f.scale(t.lowValue()(e,a))}).data(c),l.value(function(e,a){return f.scale(t.closeValue()(e,a))}).data(c),d.value(function(e,a){return t.bandwidth()(e,a)}).data(c),o.value(function(e,a){return t.defined()(e,a)}).data(c)),e.xScale(h.glScale).yScale(f.glScale).decorate(function(e){return t.decorate()(e,c,0)}),e(c.length)};return c.equals=function(){return arguments.length?(s=0>=arguments.length?void 0:arguments[0],c):s},x(c,t,V("align")),v(c,e,"context","lineWidth"),c},tt=function(){var e=function(e){return e.upperQuartile},t=function(e){return e.lowerQuartile},a=function(e){return e.high},r=function(e){return e.low},o=function(e){return e.value},s=function(e){return e.median},u="vertical",c="center",h=function(){return 5},f=N({decorate:function(){},defined:function(n,d){return l(r,a,t,e,o,s)(n,d)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return f.values=function(n,l){var i=h(n,l),d=E(c,i),g=f.xScale(),b=f.yScale();if("vertical"===u){var p=b(a(n,l));return{origin:[g(o(n,l))+d,p],high:0,upperQuartile:b(e(n,l))-p,median:b(s(n,l))-p,lowerQuartile:b(t(n,l))-p,low:b(r(n,l))-p,width:i}}var y=g(r(n,l));return{origin:[y,b(o(n,l))+d],high:g(a(n,l))-y,upperQuartile:g(e(n,l))-y,median:g(s(n,l))-y,lowerQuartile:g(t(n,l))-y,low:0,width:i}},f.xValues=function(){return"vertical"===u?[o]:[e,t,a,r,s]},f.yValues=function(){return"vertical"===u?[e,t,a,r,s]:[o]},f.orient=function(){return arguments.length?(u=0>=arguments.length?void 0:arguments[0],f):u},f.lowerQuartileValue=function(){return arguments.length?(t=T(0>=arguments.length?void 0:arguments[0]),f):t},f.upperQuartileValue=function(){return arguments.length?(e=T(0>=arguments.length?void 0:arguments[0]),f):e},f.lowValue=function(){return arguments.length?(r=T(0>=arguments.length?void 0:arguments[0]),f):r},f.highValue=function(){return arguments.length?(a=T(0>=arguments.length?void 0:arguments[0]),f):a},f.crossValue=function(){return arguments.length?(o=T(0>=arguments.length?void 0:arguments[0]),f):o},f.medianValue=function(){return arguments.length?(s=T(0>=arguments.length?void 0:arguments[0]),f):s},f.bandwidth=function(){return arguments.length?(h=T(0>=arguments.length?void 0:arguments[0]),f):h},f.align=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],f):c},f},at=function(){var e=[],t=function(e){return e},a=function(e,t){return t},i=N({decorate:function(){},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return i.xValues=function(){return e.map(function(e){return e.xValues()}).reduce(function(e,t){return e.concat(t)})},i.yValues=function(){return e.map(function(e){return e.yValues()}).reduce(function(e,t){return e.concat(t)})},i.mapping=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],i):t},i.key=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],i):a},i.series=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],i):e},i},nt=function(){var e=at(),t=y("g"),n=y("g","multi"),i=function(i){i.selection&&(n.transition(i),t.transition(i));var r=e.mapping(),l=e.series(),d=e.xScale(),o=e.yScale();i.each(function(i,s,u){var c=n(a.select(u[s]),l);c.each(function(e,n,s){e.xScale(d).yScale(o);var u=r(i,n,l),c=t(a.select(s[n]),[u]);c.call(e)});var h=c.selection?c.selection():c;h.order(),e.decorate()(c,i,s)})};return x(i,e),v(i,n,"key"),i},it=function(){var e=null,t=at(),a=function(a){var n=t.mapping(),i=t.series(),r=t.xScale(),l=t.yScale();i.forEach(function(d,o){var s=n(a,o,i);d.context(e).xScale(r).yScale(l);var u;d.decorate?(u=d.decorate(),d.decorate(function(e,n,r){t.decorate()(e,a,o),u(e,n,r)})):t.decorate()(e,a,o),d(s),u&&d.decorate(u)})};return a.context=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],a):e},x(a,t),a},rt=function(){var e=function(){return 50},t="center",a=n.scaleBand(),i=N({decorate:function(){},xScale:n.scaleLinear(),yScale:n.scaleLinear()});return i.offsetScaleForDatum=function(n,l,d){var i=e(l,d),o=E(t,i),s=i/2;return a.domain(r.range(0,n.length)).range([-s+o,s+o])},i.bandwidth=function(){return arguments.length?(e=T(0>=arguments.length?void 0:arguments[0]),i):e},i.align=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],i):t},x(i,a,w({paddingInner:"paddingOuter"})),i},lt=function(){var e="vertical",t=R(),a=it(),n=function(n){"vertical"===e?a.series(n[0].map(function(){return t})).mapping(function(e,t){return e.map(function(e){return e[t]})}):a.series(n.map(function(){return t})).mapping(function(e,t){return e[t]}),a(n)};return n.series=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],n):t},n.orient=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],n):e},x(n,a,V("series","mapping")),n},dt=function(e){return e.sort(r.ascending).filter(function(e,t,a){return-1===a.indexOf(e,t+1)})},ot=function(){var e=function(e){return e.x},t=function(e){return e.y},a=function(e){return e.color},o=function(){return 5},s=function(){return 5},u=n.interpolateViridis,c=N({decorate:function(){},defined:function(n,r){return l(e,t,a)(n,r)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return c.pathGenerator=Me().x(0).y(0),c.colorScale=function(e){var t=e.map(a);return n.scaleLinear().domain([r.min(t),r.max(t)])},c.values=function(n,r){return{x:c.xScale()(e(n,r)),y:c.yScale()(t(n,r)),colorValue:a(n,r),width:s(n,r),height:o(n,r)}},c.xValues=function(){return[e]},c.yValues=function(){return[t]},c.xValue=function(){return arguments.length?(e=T(0>=arguments.length?void 0:arguments[0]),c):e},c.yValue=function(){return arguments.length?(t=T(0>=arguments.length?void 0:arguments[0]),c):t},c.colorValue=function(){return arguments.length?(a=T(0>=arguments.length?void 0:arguments[0]),c):a},c.colorInterpolate=function(){return arguments.length?(u=0>=arguments.length?void 0:arguments[0],c):u},c.xBandwidth=function(){return arguments.length?(s=T(0>=arguments.length?void 0:arguments[0]),c):s},c.yBandwidth=function(){return arguments.length?(o=T(0>=arguments.length?void 0:arguments[0]),c):o},x(c,c.pathGenerator,w({horizontalAlign:"xAlign",verticalAlign:"yAlign"})),c};e.autoBandwidth=function(e){var t=.75,n=function(e){if(1>=e.length)return 10;e=dt(e);var a=r.pairs(e).map(function(e){return f(e[0]-e[1])}),n=r.min(a);return t*n},i=function(t,a,i){if(t.bandwidth)return t.bandwidth();var r,l=Array.isArray(a)?(r=[]).concat.apply(r,s(a)):a,d=l.filter(e.defined()).map(i()).map(t),o=n(d);return o},l=function(t){var n=function(t){if(e.xBandwidth&&e.yBandwidth)e.xBandwidth(i(e.xScale(),t,e.xValue)),e.yBandwidth(i(e.yScale(),t,e.yValue));else{var a=e.orient&&"horizontal"===e.orient()?e.yScale():e.xScale();e.bandwidth(i(a,t,e.crossValue))}};t instanceof a.selection?t.each(function(t,i,r){n(t),e(a.select(r[i]))}):(n(t),e(t))};return x(l,e),l.widthFraction=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],l):t},l},e.seriesCanvasArea=function(){var e=I(),a=t.area(),n=function(t){var n=a.context();a.defined(e.defined());var r=t.map(e.values);a.x(function(e,t){return r[t].transposedX}).y(function(e,t){return r[t].transposedY});var l="vertical"===e.orient()?"y":"x";a[l+"0"](function(e,t){return r[t].y0}),a[l+"1"](function(e,t){return r[t].y}),n.beginPath(),n.fillStyle=B.gray,n.strokeStyle="transparent",e.decorate()(n,t),a(t),n.fill(),n.stroke(),n.closePath()};return x(n,e,V("bandwidth","align")),v(n,a,"curve","context"),n},e.seriesCanvasBar=function(){var e=I(),t=Me().x(0).y(0),a=function(t){return"vertical"===e.orient()?t.height:t.width},n=function(t){return"vertical"===e.orient()?t.width:t.height},i=function(i){var r=t.context(),l=i.filter(e.defined()),d=l.map(e.values);"vertical"===e.orient()?(t.verticalAlign("top"),t.horizontalAlign("center")):(t.horizontalAlign("right"),t.verticalAlign("center")),d.forEach(function(l,d){r.save(),r.beginPath(),r.translate(l.origin[0],l.origin[1]),r.fillStyle=B.darkGray,r.strokeStyle="transparent",e.decorate()(r,l.d,d),a(t)(-l.height),n(t)(l.width),t([l]),r.fill(),r.stroke(),r.closePath(),r.restore()})};return x(i,e),v(i,t,"context"),i},e.seriesCanvasBoxPlot=function(){var e=tt(),t=Xe().value(0),a=function(a){var n=a.filter(e.defined()),r=t.context();t.orient(e.orient()),n.forEach(function(a,n){r.save();var i=e.values(a,n);r.translate(i.origin[0],i.origin[1]),r.beginPath(),r.fillStyle=B.gray,r.strokeStyle=B.black,e.decorate()(r,a,n),t.median(i.median).upperQuartile(i.upperQuartile).lowerQuartile(i.lowerQuartile).high(i.high).width(i.width).low(i.low)([a]),r.fill(),r.stroke(),r.closePath(),r.restore()})};return x(a,e),v(a,t,"cap","context"),a},e.seriesCanvasCandlestick=function(){return $e(qe())},e.seriesCanvasErrorBar=function(){var e=Ke(),t=je().value(0),a=function(a){var n=a.filter(e.defined()),r=t.context();t.orient(e.orient()),n.forEach(function(a,n){r.save();var i=e.values(a,n);r.translate(i.origin[0],i.origin[1]),r.beginPath(),r.strokeStyle=B.black,r.fillStyle=B.gray,e.decorate()(r,a,n),t.high(i.high).width(i.width).low(i.low)([a]),r.fill(),r.stroke(),r.closePath(),r.restore()})};return x(a,e),v(a,t,"context"),a},e.seriesCanvasGrouped=function(e){var t=rt(),a=function(a){a.forEach(function(n,r){var l="horizontal"!==e.orient(),d=function(e,n){var i=t.offsetScaleForDatum(a,e,n),d=l?t.xScale():t.yScale();return d(e)+i(r)+i.bandwidth()/2};l?(e.xScale(d),e.yScale(t.yScale())):(e.yScale(d),e.xScale(t.xScale())),e.bandwidth&&e.bandwidth(function(e,n){return t.offsetScaleForDatum(a,e,n).bandwidth()}),e.decorate(function(e,a){return t.decorate()(e,a,r)}),e(n)})};return x(a,e,V("decorate","xScale","yScale")),x(a,t,V("offsetScaleForDatum")),a},e.seriesCanvasHeatmap=function(){var e=ot(),t=function(t){var a=t.filter(e.defined()),n=e.colorInterpolate(),r=e.colorScale(a),l=e.pathGenerator.context();a.forEach(function(t,a){l.save(),l.beginPath();var i=e.values(t,a);l.translate(i.x,i.y),l.fillStyle=n(r(i.colorValue)),l.strokeStyle="transparent",e.decorate()(l,t,a),e.pathGenerator.height(i.height).width(i.width)([t]),l.fill(),l.stroke(),l.closePath(),l.restore()})};return v(t,e.pathGenerator,"context"),x(t,e),t},e.seriesCanvasLine=R,e.seriesCanvasMulti=it,e.seriesCanvasOhlc=function(){return $e(We())},e.seriesCanvasPoint=function(){var e=t.symbol(),a=I(),n=function(t){var n=t.filter(a.defined()),r=e.context();n.forEach(function(t,n){r.save();var i=a.values(t,n);r.translate(i.origin[0],i.origin[1]),r.beginPath(),r.strokeStyle=B.black,r.fillStyle=B.gray,a.decorate()(r,t,n),e(t,n),r.fill(),r.stroke(),r.closePath(),r.restore()})};return x(n,a,V("baseValue","bandwidth","align")),v(n,e,"size","type","context"),n},e.seriesCanvasRepeat=lt,e.seriesSvgArea=function(){var e=I(),n=t.area(),i=y("path","area"),r=function(t){t.selection&&i.transition(t),n.defined(e.defined()),t.each(function(t,r,l){var d=t.map(e.values);n.x(function(e,t){return d[t].transposedX}).y(function(e,t){return d[t].transposedY});var o="vertical"===e.orient()?"y":"x";n[o+"0"](function(e,t){return d[t].y0}),n[o+"1"](function(e,t){return d[t].y});var s=i(a.select(l[r]),[t]);s.enter().attr("fill",B.gray),s.attr("d",n),e.decorate()(s,t,r)})};return x(r,e,V("bandwidth","align")),v(r,i,"key"),v(r,n,"curve"),r},e.seriesSvgBar=function(){var e=Me().x(0).y(0),t=I(),n=y("g","bar"),r=function(e){return"vertical"===t.orient()?e.height:e.width},l=function(e){return"vertical"===t.orient()?e.width:e.height},d=function(e){return"translate("+e[0]+", "+e[1]+")"},o=function(i){i.selection&&n.transition(i),i.each(function(i,o,s){var u=t.orient();if("vertical"!==u&&"horizontal"!==u)throw new Error("The bar series does not support an orientation of "+u);var c=i.filter(t.defined()),h=c.map(t.values);e.width(0).height(0),"vertical"===t.orient()?(e.verticalAlign("top"),e.horizontalAlign("center")):(e.horizontalAlign("right"),e.verticalAlign("center"));var f=n(a.select(s[o]),c);f.enter().attr("transform",function(e,t){return d(h[t].baseOrigin)}).attr("class","bar "+t.orient()).attr("fill",B.darkGray).append("path").attr("d",function(t,a){return l(e)(h[a].width),e([t])}),f.attr("transform",function(e,t){return d(h[t].origin)}).select("path").attr("d",function(t,a){return l(e)(h[a].width),r(e)(-h[a].height),e([t])}),t.decorate()(f,c,o)})};return x(o,t),v(o,n,"key"),o},e.seriesSvgBoxPlot=function(){var e=tt(),t=y("g","box-plot"),n=Xe().value(0),i=function(e){return function(t){return e.selection?t.transition(e):t}},r=function(e){return"translate("+e.origin[0]+", "+e.origin[1]+")"},l=function(l){l.selection&&t.transition(l);var o=i(l);l.each(function(i,l,d){var s=i.filter(e.defined()),u=t(a.select(d[l]),s);u.enter().attr("stroke",B.black).attr("fill",B.gray).attr("transform",function(t,a){return r(e.values(t,a))+" scale(1e-6, 1)"}).append("path"),n.orient(e.orient()),u.each(function(t,l,i){var d=e.values(t,l);n.median(d.median).upperQuartile(d.upperQuartile).lowerQuartile(d.lowerQuartile).width(d.width).high(d.high).low(d.low),o(a.select(i[l])).attr("transform",r(d)).select("path").attr("d",n([t]))}),e.decorate()(u,i,l)})};return x(l,e),v(l,t,"key"),v(l,n,"cap"),l},e.seriesSvgCandlestick=function(){return Ze(qe(),"candlestick")},e.seriesSvgErrorBar=function(){var e=Ke(),t=y("g","error-bar"),n=je().value(0),i=function(e){return function(t){return e.selection?t.transition(e):t}},r=function(e){return"translate("+e.origin[0]+", "+e.origin[1]+")"},l=function(l){l.selection&&t.transition(l);var o=i(l);l.each(function(i,l,d){var s=i.filter(e.defined()),u=s.map(e.values),c=t(a.select(d[l]),s);c.enter().attr("stroke",B.black).attr("fill",B.gray).attr("transform",function(t,a){return r(e.values(t,a))+" scale(1e-6, 1)"}).append("path"),n.orient(e.orient()),c.each(function(e,t,i){var l=u[t];n.high(l.high).low(l.low).width(l.width),o(a.select(i[t])).attr("transform",r(l)+" scale(1)").select("path").attr("d",n([e]))}),e.decorate()(c,i,l)})};return x(l,e),v(l,t,"key"),l},e.seriesSvgGrouped=function(e){var t=rt(),n=y("g","grouped"),i=function(i){i.selection&&n.transition(i),i.each(function(r,l,d){var o=n(a.select(d[l]),r);o.enter().append("g"),o.select("g").each(function(n,l,d){var o=a.select(d[l]),s="horizontal"!==e.orient(),u=function(e,a){var n=t.offsetScaleForDatum(r,e,a),i=s?t.xScale():t.yScale();return i(e)+n(l)+n.bandwidth()/2};s?(e.xScale(u),e.yScale(t.yScale())):(e.yScale(u),e.xScale(t.xScale())),e.bandwidth&&e.bandwidth(function(e,a){return t.offsetScaleForDatum(r,e,a).bandwidth()}),e.decorate(function(e,a){return t.decorate()(e,a,l)}),o.call(e)})})};return x(i,e,V("decorate","xScale","yScale")),x(i,t,V("offsetScaleForDatum")),i},e.seriesSvgHeatmap=function(){var e=ot(),t=y("g","box"),n=function(e){return"translate("+e.x+", "+e.y+")"},i=function(i){i.each(function(i,r,l){var d=i.filter(e.defined()),o=e.colorValue(),s=e.colorInterpolate(),u=e.colorScale(d),c=t(a.select(l[r]),d);c.enter().append("path").attr("stroke","transparent"),c.attr("transform",function(t,a){return n(e.values(t,a))}).select("path").attr("d",function(t,a){return e.pathGenerator.width(e.values(t,a).width).height(e.values(t,a).height)([t])}).attr("fill",function(e,t){return s(u(o(e,t)))}),e.decorate()(c,i,r)})};return x(i,e),i},e.seriesSvgLine=P,e.seriesSvgMulti=nt,e.seriesSvgOhlc=function(){return Ze(We(),"ohlc")},e.seriesSvgPoint=function(){var e=t.symbol(),n=I(),i=y("g","point"),r=function(e){return"translate("+e[0]+", "+e[1]+")"},l=function(t){t.selection&&i.transition(t),t.each(function(t,l,d){var o=t.filter(n.defined()),s=i(a.select(d[l]),o);s.enter().attr("transform",function(e,t){return r(n.values(e,t).origin)}).attr("fill",B.gray).attr("stroke",B.black).append("path"),s.attr("transform",function(e,t){return r(n.values(e,t).origin)}).select("path").attr("d",e),n.decorate()(s,t,l)})};return x(l,n,V("baseValue","bandwidth","align")),v(l,i,"key"),v(l,e,"type","size"),l},e.seriesSvgRepeat=function(){var e="vertical",t=P(),n=nt(),i=function(i){return i.each(function(i,r,l){"vertical"===e?n.series(i[0].map(function(){return t})).mapping(function(e,t){return e.map(function(e){return e[t]})}):n.series(i.map(function(){return t})).mapping(function(e,t){return e[t]}),a.select(l[r]).call(n)})};return i.series=function(){return arguments.length?(t=0>=arguments.length?void 0:arguments[0],i):t},i.orient=function(){return arguments.length?(e=0>=arguments.length?void 0:arguments[0],i):e},x(i,n,V("series","mapping")),i},e.seriesWebglArea=function(){var e=I(),t=He(0,1),a=t.offset(1),n=He(0,1),i=n.offset(1),r=He(0,1),l=r.offset(1),d=He(0,1).type(ce.UNSIGNED_BYTE),o=d.offset(1),s=Se().crossValueAttribute(a).crossPreviousValueAttribute(t).mainValueAttribute(i).mainPreviousValueAttribute(n).baseValueAttribute(l).basePreviousValueAttribute(r).definedAttribute(d).definedNextAttribute(o),u=function(){return!1},c=[],h=function(a){if("vertical"!==e.orient())throw new Error("Unsupported orientation ".concat(e.orient()));var l=ze(e.xScale()),o=ze(e.yScale());_(l.scale)&&_(o.scale)&&u(c,a)||(c=a,t.value(function(t,a){return l.scale(e.crossValue()(t,a))}).data(a),n.value(function(t,a){return o.scale(e.mainValue()(t,a))}).data(a),r.value(function(t,a){return o.scale(e.baseValue()(t,a))}).data(a),d.value(function(t,a){return e.defined()(t,a)}).data(a)),s.xScale(l.glScale).yScale(o.glScale).decorate(function(t){return e.decorate()(t,a,0)}),s(a.length)};return h.equals=function(){return arguments.length?(u=0>=arguments.length?void 0:arguments[0],h):u},x(h,e,V("bandwidth","align")),v(h,s,"context"),h},e.seriesWebglBar=function(){var e=I(),t=De(),a=De(),n=De(),i=De().type(ce.UNSIGNED_SHORT),r=De().type(ce.UNSIGNED_BYTE),l=Ne().crossValueAttribute(t).mainValueAttribute(a).baseValueAttribute(n).bandwidthAttribute(i).definedAttribute(r),d=function(){return!1},o=[],s=function(s){if("vertical"!==e.orient())throw new Error("Unsupported orientation ".concat(e.orient()));var u=ze(e.xScale()),c=ze(e.yScale());_(u.scale)&&_(c.scale)&&d(o,s)||(o=s,t.value(function(t,a){return u.scale(e.crossValue()(t,a))}).data(s),a.value(function(t,a){return c.scale(e.mainValue()(t,a))}).data(s),n.value(function(t,a){return c.scale(e.baseValue()(t,a))}).data(s),i.value(function(t,a){return e.bandwidth()(t,a)}).data(s),r.value(function(t,a){return e.defined()(t,a)}).data(s)),l.xScale(u.glScale).yScale(c.glScale).decorate(function(t){return e.decorate()(t,s,0)}),l(s.length)};return s.equals=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],s):d},x(s,e,V("align")),v(s,l,"context"),s},e.seriesWebglBoxPlot=function(){var e=tt(),t=De(),a=De(),n=De(),i=De(),r=De(),l=De(),d=De().type(ce.UNSIGNED_SHORT),o=De().type(ce.UNSIGNED_SHORT),s=De().type(ce.UNSIGNED_BYTE),u=ke().crossValueAttribute(t).highValueAttribute(a).upperQuartileValueAttribute(n).medianValueAttribute(i).lowerQuartileValueAttribute(r).lowValueAttribute(l).bandwidthAttribute(d).capAttribute(o).definedAttribute(s),c=function(){return!1},h=[],f=T(20),g=function(g){if("vertical"!==e.orient())throw new Error("Unsupported orientation ".concat(e.orient()));var b=ze(e.xScale()),p=ze(e.yScale());_(b.scale)&&_(p.scale)&&c(h,g)||(h=g,t.value(function(t,a){return b.scale(e.crossValue()(t,a))}).data(g),a.value(function(t,a){return p.scale(e.highValue()(t,a))}).data(g),n.value(function(t,a){return p.scale(e.upperQuartileValue()(t,a))}).data(g),i.value(function(t,a){return p.scale(e.medianValue()(t,a))}).data(g),r.value(function(t,a){return p.scale(e.lowerQuartileValue()(t,a))}).data(g),l.value(function(t,a){return p.scale(e.lowValue()(t,a))}).data(g),d.value(function(t,a){return e.bandwidth()(t,a)}).data(g),o.value(function(e,t){return f(e,t)}).data(g),s.value(function(t,a){return e.defined()(t,a)}).data(g)),u.xScale(b.glScale).yScale(p.glScale).decorate(function(t){return e.decorate()(t,g,0)}),u(g.length)};return g.cap=function(){return arguments.length?(f=T(0>=arguments.length?void 0:arguments[0]),g):f},g.equals=function(){return arguments.length?(c=0>=arguments.length?void 0:arguments[0],g):c},x(g,e,V("align")),v(g,u,"context","lineWidth"),g},e.seriesWebglCandlestick=function(){return et(Re())},e.seriesWebglErrorBar=function(){var e=Ke(),t=De(),a=De(),n=De(),i=De().type(ce.UNSIGNED_SHORT),r=De().type(ce.UNSIGNED_BYTE),l=Be().crossValueAttribute(t).highValueAttribute(a).lowValueAttribute(n).bandwidthAttribute(i).definedAttribute(r),d=function(){return!1},o=[],s=function(s){if("vertical"!==e.orient())throw new Error("Unsupported orientation ".concat(e.orient()));var u=ze(e.xScale()),c=ze(e.yScale());_(u.scale)&&_(c.scale)&&d(o,s)||(o=s,t.value(function(t,a){return u.scale(e.crossValue()(t,a))}).data(s),a.value(function(t,a){return c.scale(e.highValue()(t,a))}).data(s),n.value(function(t,a){return c.scale(e.lowValue()(t,a))}).data(s),i.value(function(t,a){return e.bandwidth()(t,a)}).data(s),r.value(function(t,a){return e.defined()(t,a)}).data(s)),l.xScale(u.glScale).yScale(c.glScale).decorate(function(t){return e.decorate()(t,s,0)}),l(s.length)};return s.equals=function(){return arguments.length?(d=0>=arguments.length?void 0:arguments[0],s):d},x(s,e,V("align")),v(s,l,"context","lineWidth"),s},e.seriesWebglLine=function(){var e=I(),t=He(-1,2),a=t.offset(1),n=t.offset(2),i=t.offset(-1),r=He(-1,2),l=r.offset(1),d=r.offset(2),o=r.offset(-1),s=He(0,1).type(ce.UNSIGNED_BYTE),u=s.offset(1),c=Ve().crossPreviousValueAttribute(t).crossValueAttribute(a).crossNextValueAttribute(n).crossPreviousPreviousValueAttribute(i).mainPreviousValueAttribute(r).mainValueAttribute(l).mainNextValueAttribute(d).mainPreviousPreviousValueAttribute(o).definedAttribute(s).definedNextAttribute(u),h=function(){return!1},f=[],g=function(a){var n=ze(e.xScale()),l=ze(e.yScale());_(n.scale)&&_(l.scale)&&h(f,a)||(f=a,"vertical"===e.orient()?(t.value(function(t,a){return n.scale(e.crossValue()(t,a))}).data(a),r.value(function(t,a){return l.scale(e.mainValue()(t,a))}).data(a)):(t.value(function(t,a){return n.scale(e.mainValue()(t,a))}).data(a),r.value(function(t,a){return l.scale(e.crossValue()(t,a))}).data(a)),s.value(function(t,a){return e.defined()(t,a)}).data(a)),c.xScale(n.glScale).yScale(l.glScale).decorate(function(t){return e.decorate()(t,a,0)}),c(a.length)};return g.equals=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],g):h},x(g,e,V("baseValue","bandwidth","align")),v(g,c,"context","lineWidth"),g},e.seriesWebglMulti=it,e.seriesWebglOhlc=function(){return et(Te())},e.seriesWebglPoint=function(){var e=I(),t=T(64),a=g.symbolCircle,n=De(),i=De(),r=De().type(ce.UNSIGNED_SHORT),l=De().type(ce.UNSIGNED_BYTE),d=me().crossValueAttribute(n).mainValueAttribute(i).sizeAttribute(r).definedAttribute(l),o=function(){return!1},s=[],u=function(u){var c=ze(e.xScale()),h=ze(e.yScale());_(c.scale)&&_(h.scale)&&o(s,u)||(s=u,"vertical"===e.orient()?(n.value(function(t,a){return c.scale(e.crossValue()(t,a))}).data(u),i.value(function(t,a){return h.scale(e.mainValue()(t,a))}).data(u)):(n.value(function(t,a){return c.scale(e.mainValue()(t,a))}).data(u),i.value(function(t,a){return h.scale(e.crossValue()(t,a))}).data(u)),r.value(function(e,a){return t(e,a)}).data(u),l.value(function(t,a){return e.defined()(t,a)}).data(u)),d.xScale(c.glScale).yScale(h.glScale).type(Fe(a)).decorate(function(t){return e.decorate()(t,u,0)}),d(u.length)};return u.size=function(){return arguments.length?(t=T(0>=arguments.length?void 0:arguments[0]),u):t},u.type=function(){return arguments.length?(a=0>=arguments.length?void 0:arguments[0],u):a},u.equals=function(){return arguments.length?(o=0>=arguments.length?void 0:arguments[0],u):o},x(u,e,V("baseValue","bandwidth","align")),v(u,d,"context"),u},e.seriesWebglRepeat=lt,Object.defineProperty(e,"__esModule",{value:!0})});
